FROM minokun/ocr_speech_rec:v1.0
WORKDIR  /home
COPY *.py ./
RUN cythonize ocr.py
RUN cythonize recorder.py
RUN cythonize speech_rec.py
RUN gcc -finput-charset=utf-8 -fPIC -shared ocr.c -o ocr.so -I/usr/include/python3.10 -L/usr/lib/python3.10/config-3.10-aarch64-linux-gnu
RUN gcc -finput-charset=utf-8 -fPIC -shared recorder.c -o recorder.so -I/usr/include/python3.10 -L/usr/lib/python3.10/config-3.10-aarch64-linux-gnu
RUN gcc -finput-charset=utf-8 -fPIC -shared speech_rec.c -o speech_rec.so -I/usr/include/python3.10 -L/usr/lib/python3.10/config-3.10-aarch64-linux-gnu
RUN rm -rf *.c
RUN find . -type f ! -name 'main.py' -name '*.py' -exec rm -f {} +
ENTRYPOINT  ["python", "main.py"]